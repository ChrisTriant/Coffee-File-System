# ASKISI4
Χρήστος Τριανταφύλλου Αρχολέκας sdi1700166
Rena Canga sdi1700218

Το πρόγραμμα υλοποιήθηκε ως εξής.
Στην main, τρέχει η συνάρτηση get_options() η οποία δέχεται τις εντολές από τον χρήστη και καλεί τις αντίστοιχες συναρτήσεις.Επίσης κρατάει το node id του τρέχοντος καταλόγου.

cfs_create(): Δημιουγεί ένα cfs αρχείο ,με το δωσμένο από τον χρήστη όνομα, αν αυτό δεν υπάρχει αλλίως εκτυπώνει ανάλογο μήνυμα. H create δέχεται μόνο το -bs σαν όρισμα και θέτει στο block size του αρχείου την τιμή που δέχεται από τον χρήστη. Αν δεν δοθεί παράμετρος το block size παίρνει default τιμή 512. To file name size το θεωρούμε σταθερό 100 bytes και για τα άλλα ορίσματα θεωρήθηκε πως το max είναι ο αριθμός που χωράει σε κάθε μπλοκ οπότε αγνοούνται. Στην αρχή του cfs αρχείου τοποθετείται ένα super block που περιέχει το αναγνωριστικό cfs, το block size, ένας counter για τον αριθμό των περιεχομένων του superblock και ένας counter για τον συνολικό αριθμό των nodes στο αρχείο (εκτός του superblock). Στα περιεχόμενα του αποθηκέυονται τα node id των μπλοκ που έχουν διαγραφεί, και στην συνέχεια χρησιμοποιούνται για την αποφυγή ύπαρξης holes.
Τέλος δημιουργεί το root block.

cfs_workwith(): Aνοίγει το δωσμένο cfs αρχείο και θέτει σε μια global μεταβλητή την τιμή του file descriptor που επέστρεψε η open(). Αυτή η global μεταβλητή χρησιμοποιείται από τις cfs συναρτήσεις (σε όλες τις υπόλοιπες περνάει ως όρισμα). Αν η workwith δεν κληθεί η μεταβλητή αυτή έχει τιμή -1 και δεν μπορούν να κληθούν οι cfs εντολές. Η workwith μπορεί να επανακληθεί με όρισμα το όνομα ενός άλλου αρχείου για να δουλέψουμε πλέον πάνω σε αυτό.

cfs_mkdir(): Δημιουργεί καταλόγους στον τρέχοντα κατάλογο, με το όνομα ή ονόματα που δίνει ο χρήστης.Στα δεδομένα των καταλόγων αποθηκεύονται τα node id's των στοιχείων που βρίσκονται μέσα σε αυτά.

cfs_touch(): Δημιουργεί αρχεία στον τρέχοντα κατάλογο, με το όνομα ή ονόματα που δίνει ο χρήστης.
Επίσης δέχεται και τα ζητούμενα ορίσματα που αναφέρονται στην εκφώνηση.

Μέσα στα αρχεία και τους φακέλους αποθηκεύονται οι δομές MDS που περιέχουν δεδομένα (το datastream δεν καταλάβαμε που χρησιμεύει οπότε αγνοήθηκε).

cfs_pwd(): Γίνεται εμφάνιση τρέχοντος καταλόγου ξεκινώντας απο το root του cfs. Αυτό γίνεται αναδρομικά χρησιμοποιώντας τα γονικά node id's. Η pwd χρησιμοποιείται μέσα στην scan_options για την αναπαράσταση του shell.

cfs_cd(): Εκτελεί αλλαγή καταλόγου. Χρησιμοποιεί την συνάρτηση find path η οποία κάνει αναζήτηση του path και επιστρέφει 0 αν το path βρεθεί αλλιώς αρνητικό αριθμό αν το path δεν υπάρχει ή είναι αρχείο και όχι κατάλογος.
Αν κληθεί επιτυχώς αλλάζει το current_nodeid (το node id του τρέχοντος καταλόγου).

cfs_ls(): Η ενδιάμεση συνάρτηση call_ls() διαβάζει τα arguments που δίνει ο χρήστης και δημιουργεί ένα struct options το οποίο περνάει μέσα στην ls ώστε αυτή να δράσει ανάλογα. Αν δοθούν σαν ορίσματα και το -d και το -h, το -h αγνοείται.

cfs_cp(): Αντιγράφει τα αρχεία στο δωσμένο path. Aν για path δόθηκε ένα απλό όνομα, τότε δημιουργείται αρχείο με το όνομα αυτό και με τα δεδομένα του source. Tα directories αντιγράφονται μονάχα αν έχει δοθεί σαν όρισμα το -r ή -R (κάνουν την ίδια δουλεία).

cfs_cat(): Αντιγράφει τα δεδομένα τών source αρχείων σε έναν buffer και στην συνέχεια δημιουργεί ένα αρχείο με τα δεδομένα αυτά.

cfs_ln(): Δημιουργεί ένα νέο αρχείο  που είναι σκληρός σύνδεσμος στο αρχείο input εκτός αν αυτό είναι directory.

cfs_mv(): Αν δοθεί μόνο ένα source αρχείο και ένα όνομα (όχι path), τότε το αρχείο γίνεται renamed σε αυτό το όνομα. Αλλιώς αν είναι path, το ή τα source αρχεία/directories μετακινούνται εκεί.

cfs_rm(): Γίνεται η διαγραφή του του input που δίνει ο χρήστης. Αν το option -r δεν δοθεί τότε οι φάκελοι δεν διαγράφονται.Αλλιώς γίνεται αναδρομική κλήση της συνάρτησης rec_rm η οποία διαγράφει τον κατάλογο και όλα του τα περιεχόμενα. Η rm_file ενημερώνει το superblock για τα holes που δημιουργούνται και καλεί την rm_nodeid η οποία αφαιρεί το nodeid του input από τα δεδομένα του πατέρα του.

Οι cfs_import/export δεν υλοποιήθηκαν.

Στο αρχείο cfs_fun.c βρίσκονται όλες οι cfs και οι πιο σημαντικές συναρτήσεις και στο αρχείο fun.c βρίσκονται βοηθητικές συναρτήσεις και συναρτήσεις διαχείρησης των blocks.  





	


